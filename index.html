<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>VR Explorer</title>
<link rel="manifest" href="manifest.json">
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1 {
    text-align: center;
    margin-bottom: 40px; /* more space between main title and Step 1 */
  }

  h2 {
    text-align: center;
    margin: 15px 0;
  }

  .step {
    margin-bottom: 60px; /* more spacing between Step 1 and Step 2 */
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  label {
    display: block;
    margin-bottom: 5px;
    text-align: center;
    font-weight: bold;
  }

  select, button {
    margin: 10px 0;
    padding: 10px;
    font-size: 1rem;
    min-width: 220px;
  }

  button:disabled {
    background-color: grey;
    cursor: not-allowed;
  }

  .footer {
    font-size: 0.8rem;
    font-style: italic;
    margin-top: 40px;
    margin-bottom: 20px;
    text-align: center;
  }

  .toggle-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 20px;
  }

  .toggle-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 220px;
  }

  .switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 28px;
  }

  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #555;
    transition: .4s;
    border-radius: 28px;
  }

  .slider:before {
    position: absolute;
    content: "";
    height: 22px;
    width: 22px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
  }

  input:checked + .slider {
    background-color: #4CAF50;
  }

  input:checked + .slider:before {
    transform: translateX(32px);
  }
</style>
</head>
<body>

<h1>VR Explorer</h1>

<!-- Step 1 -->
<div class="step">
  <h2>Step 1: Select Simulation</h2>

  <div>
    <label for="audienceSelect">Presentation Audiences:</label>
    <select id="audienceSelect">
      <option value="">--select option--</option>
    </select>
  </div>

  <div style="margin:10px 0; text-align:center;">or</div>

  <div>
    <label for="scenarioSelect">Special Scenarios:</label>
    <select id="scenarioSelect">
      <option value="">--select option--</option>
    </select>
  </div>
</div>

<!-- Step 2 -->
<div class="step">
  <h2>Step 2: Enter Simulation</h2>
  <button id="goButton" disabled>Go</button>

  <div class="toggle-container">
    <div class="toggle-item">
      <span>Safe Mode 1</span>
      <label class="switch">
        <input type="checkbox" id="safeMode1">
        <span class="slider"></span>
      </label>
    </div>
    <div class="toggle-item">
      <span>Safe Mode 2</span>
      <label class="switch">
        <input type="checkbox" id="safeMode2">
        <span class="slider"></span>
      </label>
    </div>
  </div>
</div>

<div class="footer">
  VR Explorer 1.1 brought to you by Cambridge VR
</div>

<script>
  // -----------------------------
  // Video Links
  // -----------------------------
  const videosCloudflare = {
    "Audience of 0": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N0-CF.h264.mp4",
    "Audience of 1": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N1-CF.h264.mp4",
    "Audience of 2": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N2-CF.h264.mp4",
    "Audience of 4": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N4-CF.h264.mp4",
    "Audience of 9": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N9-CF.h264.mp4",
    "Audience of 16": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N16-CF.h264.mp4",
    "Audience of 25": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N25-CF.h264.mp4",
    "Audience of 50": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N50-CF.h264.mp4",
    "Audience of 100": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N100-CF.h264.mp4",
    "Audience of 500": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N500-CF.h264.mp4",
    "Audience of 1000s": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/N10K-CF.h264.mp4",
    "TV teleprompter": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/ACC01-CF.h264.mp4",
    "Job interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/JIC01-CF.h264.mp4",
    "Radio interview": "https://pub-850a8ef9d4f34159a20706a415caaaf8.r2.dev/RIC01-CF.h264.mp4"
  };

  const videosYouTube = {
    "Audience of 0": "https://www.youtube.com/watch?v=8D5ZJjV-9No",
    "Audience of 1": "https://www.youtube.com/watch?v=L61TY-lVWYc",
    "Audience of 2": "https://www.youtube.com/watch?v=jisLJabMOaw",
    "Audience of 4": "https://www.youtube.com/watch?v=583YioSTgGE",
    "Audience of 9": "https://www.youtube.com/watch?v=7AS7NEA9PFo",
    "Audience of 16": "https://www.youtube.com/watch?v=_y-lSw1SNaU",
    "Audience of 25": "https://www.youtube.com/watch?v=CBBwXbX5ogE",
    "Audience of 50": "https://www.youtube.com/watch?v=RUnKCfWFSfI",
    "Audience of 100": "https://www.youtube.com/watch?v=ww986pYF46E",
    "Audience of 500": "https://www.youtube.com/watch?v=S3Ve7FGfjWk",
    "Audience of 1000s": "https://www.youtube.com/watch?v=jyUNFPBmJkA",
    "TV teleprompter": "https://www.youtube.com/watch?v=3ZNddx_YNc0",
    "Job interview": "https://www.youtube.com/watch?v=-tsxJfabw0s",
    "Radio interview": "https://www.youtube.com/watch?v=sE3pahN4BwI"
  };

  // -----------------------------
  // Populate dropdowns
  // -----------------------------
  const audienceSelect = document.getElementById('audienceSelect');
  const scenarioSelect = document.getElementById('scenarioSelect');

  Object.keys(videosCloudflare).forEach(name => {
    if(name.startsWith("Audience")) {
      let option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      audienceSelect.appendChild(option);
    }
  });

  Object.keys(videosCloudflare).forEach(name => {
    if(!name.startsWith("Audience")) {
      let option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      scenarioSelect.appendChild(option);
    }
  });

  // -----------------------------
  // Enable Go button
  // -----------------------------
  const goButton = document.getElementById('goButton');
  function checkSelection() {
    if(audienceSelect.value || scenarioSelect.value) {
      goButton.disabled = false;
    } else {
      goButton.disabled = true;
    }
  }
  audienceSelect.addEventListener('change', checkSelection);
  scenarioSelect.addEventListener('change', checkSelection);

  // -----------------------------
  // Safe Mode toggles
  // -----------------------------
  const safeMode1 = document.getElementById('safeMode1');
  const safeMode2 = document.getElementById('safeMode2');

  function enforceSingleToggle(clicked) {
    if(clicked === safeMode1) safeMode2.checked = false;
    if(clicked === safeMode2) safeMode1.checked = false;
  }

  safeMode1.addEventListener('change', () => enforceSingleToggle(safeMode1));
  safeMode2.addEventListener('change', () => enforceSingleToggle(safeMode2));

  // -----------------------------
  // Go button click
  // -----------------------------
  goButton.addEventListener('click', () => {
    const selection = audienceSelect.value || scenarioSelect.value;
    if(!selection) return;

    if(safeMode1.checked) {
      // Safe Mode 1: YouTube fallback
      window.open(videosYouTube[selection], "_blank");
    } else {
      // Default / Safe Mode 2: VR player with A-Frame
      startVRPlayer(selection, safeMode2.checked);
    }
  });

  // -----------------------------
  // VR Player with A-Frame and IPD slider
  // -----------------------------
  function startVRPlayer(selection, adjustableIPD=false) {
    const existingScene = document.querySelector('a-scene');
    if(existingScene) existingScene.remove();

    const scene = document.createElement('a-scene');
    scene.setAttribute('embedded', true);
    scene.setAttribute('vr-mode-ui', 'enabled: true');
    scene.setAttribute('style', 'width:100vw; height:100vh; position:fixed; top:0; left:0;');

    const camera = document.createElement('a-entity');
    camera.setAttribute('id', 'cameraRig');
    camera.setAttribute('camera', '');
    camera.setAttribute('position', '0 1.6 0');
    camera.setAttribute('look-controls', '');
    scene.appendChild(camera);

    const videosphere = document.createElement('a-videosphere');
    videosphere.setAttribute('src', videosCloudflare[selection]);
    videosphere.setAttribute('rotation', '0 -90 0');
    scene.appendChild(videosphere);

    document.body.appendChild(scene);

    if(adjustableIPD) {
      const ipdSlider = document.createElement('input');
      ipdSlider.type = 'range';
      ipdSlider.min = 50;
      ipdSlider.max = 80;
      ipdSlider.value = 63;
      ipdSlider.style.position = 'absolute';
      ipdSlider.style.bottom = '20px';
      ipdSlider.style.left = '50%';
      ipdSlider.style.transform = 'translateX(-50%)';
      ipdSlider.style.width = '60%';
      ipdSlider.style.zIndex = '9999';
      document.body.appendChild(ipdSlider);

      ipdSlider.addEventListener('input', () => {
        const cameraEl = document.querySelector('#cameraRig');
        const threeCamera = cameraEl.getObject3D('camera');
        if(threeCamera && threeCamera.cameras) {
          threeCamera.cameras[0].eyeSep = ipdSlider.value / 100;
          threeCamera.cameras[1].eyeSep = ipdSlider.value / 100;
        }
      });
    }
  }
</script>
</body>
</html>
